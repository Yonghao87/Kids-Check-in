<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿæ˜Ÿå¤§ä½œæˆ˜</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", å¹¼åœ†, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 1400px;
            width: 100%;
        }
        
        /* é¡¶éƒ¨æ ‡é¢˜æ  */
        .header {
            background: linear-gradient(135deg, #ffd6e7 0%, #c2e9fb 100%);
            border-radius: 25px;
            padding: 30px 25px;
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            border: 2px solid white;
            width: 100%;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.3;
            z-index: 0;
        }
        
        /* å¤´åƒæ ·å¼ */
        .avatar-container {
            position: relative;
            margin-bottom: 20px;
            z-index: 1;
        }
        
        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 5px solid white;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .avatar:hover {
            transform: scale(1.05);
        }
        
        .avatar-upload {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #4299e1, #3182ce);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(66, 153, 225, 0.4);
            transition: all 0.3s ease;
            z-index: 2;
        }
        
        .avatar-upload:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(66, 153, 225, 0.5);
        }
        
        #avatarInput {
            display: none;
        }
        
        .header h1 {
            font-size: 2.5rem;
            color: #2d3748;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8);
            background: linear-gradient(135deg, #d63384, #4299e1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            z-index: 1;
            position: relative;
        }
        
        .header p {
            color: #4a5568;
            font-size: 1.1rem;
            margin-bottom: 8px;
            z-index: 1;
            position: relative;
        }
        
        .header .date {
            color: #718096;
            font-size: 1rem;
            background-color: rgba(255,255,255,0.7);
            padding: 5px 15px;
            border-radius: 20px;
            margin-top: 5px;
            z-index: 1;
            position: relative;
        }
        
        .header .crown-icon {
            position: absolute;
            top: 25px;
            right: 25px;
            font-size: 2.5rem;
            color: #fcc367;
            filter: drop-shadow(0 4px 8px rgba(252, 195, 103, 0.4));
            animation: float 3s ease-in-out infinite;
            z-index: 1;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* åŠŸèƒ½æŒ‰é’®æ  */
        .btn-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            width: 100%;
        }
        
        .btn-bar button {
            padding: 12px 25px;
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            border: none;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .save-btn {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
        }
        
        .save-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(72, 187, 120, 0.3);
        }
        
        .reset-btn {
            background: linear-gradient(135deg, #e53e3e, #c53030);
            color: white;
        }
        
        .reset-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(229, 62, 62, 0.3);
        }
        
        .manage-subject-btn {
            background: linear-gradient(135deg, #9f7aea, #805ad5);
            color: white;
        }
        
        .manage-subject-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(159, 122, 234, 0.3);
        }
        
        .import-export-btn {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
            color: white;
        }
        
        .import-export-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(237, 137, 54, 0.3);
        }
        
        .batch-all-btn {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
        }
        
        .batch-all-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(66, 153, 225, 0.3);
        }
        
        .view-history-btn {
            background: linear-gradient(135deg, #38b2ac, #319795);
            color: white;
        }
        
        .view-history-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(56, 178, 172, 0.3);
        }
        
        /* æ¿å—æ ‡é¢˜ */
        .section-title {
            font-size: 1.8rem;
            color: #2d3748;
            margin: 40px 0 25px;
            padding-left: 15px;
            border-left: 6px solid #4299e1;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .section-title::before {
            content: "â˜…";
            position: absolute;
            left: -15px;
            top: 50%;
            transform: translateY(-50%);
            background: white;
            padding: 5px;
            border-radius: 50%;
            font-size: 1rem;
            color: #4299e1;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .section-title .add-subject-btn {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .section-title .add-subject-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.3);
        }
        
        /* å¡ç‰‡ç½‘æ ¼ */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
            width: 100%;
        }
        
        /* ç§‘ç›®å¡ç‰‡ */
        .subject-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            position: relative;
            transition: all 0.4s ease;
            border: 2px solid transparent;
            overflow: hidden;
        }
        
        .subject-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            border-color: var(--btn-primary);
        }
        
        .subject-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--title-color), var(--star-color));
        }
        
        .subject-card .subject-name {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--title-color);
            position: relative;
            display: inline-block;
        }
        
        .subject-card .subject-name::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 3px;
            background: var(--title-color);
            border-radius: 2px;
        }
        
        .subject-card .score-num {
            font-size: 3rem;
            font-weight: bold;
            margin: 15px 0;
            color: var(--num-color);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subject-card .stars-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            min-height: 40px;
        }
        
        .subject-card .star {
            font-size: 1.8rem;
            color: #e2e8f0;
            transition: all 0.3s ease;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .subject-card .star.active {
            color: var(--star-color);
            animation: starGlow 2s infinite;
        }
        
        @keyframes starGlow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        /* çš‡å† ä¿¡æ¯ */
        .crown-info {
            font-size: 0.95rem;
            color: #4a5568;
            margin-bottom: 15px;
            background-color: #f8f9fa;
            padding: 10px 15px;
            border-radius: 10px;
            border-left: 4px solid #fcc367;
        }
        
        /* å…‘æ¢æç¤º */
        .exchange-tip {
            font-size: 0.9rem;
            color: #718096;
            background-color: #f7fafc;
            padding: 10px 15px;
            border-radius: 10px;
            display: inline-block;
            border: 1px solid #e2e8f0;
            width: 100%;
            box-sizing: border-box;
        }
        
        /* åˆ é™¤ç§‘ç›®æŒ‰é’® */
        .delete-subject-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: rgba(229, 62, 62, 0.1);
            color: #e53e3e;
            border: 1px solid #e53e3e;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            opacity: 0;
        }
        
        .subject-card:hover .delete-subject-btn {
            opacity: 1;
        }
        
        .delete-subject-btn:hover {
            background-color: #e53e3e;
            color: white;
        }
        
        /* ç§‘ç›®æŒ‰é’®ç»„ */
        .btn-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .add-btn, .minus-btn {
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .add-btn {
            background: linear-gradient(135deg, var(--btn-primary), var(--btn-hover));
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .add-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        
        .minus-btn {
            background: linear-gradient(135deg, var(--btn-secondary), var(--btn-secondary-hover));
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .minus-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        
        /* æ‰¹é‡åŠ åˆ†æ¨¡æ€æ¡† */
        .batch-modal, .subject-modal, .history-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .batch-modal-content, .subject-modal-content, .history-modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
        }
        
        .modal-header h2 {
            font-size: 1.8rem;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #718096;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .close-modal:hover {
            color: #e53e3e;
        }
        
        /* æ‰¹é‡åŠ åˆ†è¡¨å• */
        .batch-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-group label {
            font-weight: 600;
            color: #4a5568;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            padding: 12px 15px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
            outline: none;
        }
        
        .subject-checkboxes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 10px;
        }
        
        .subject-checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border-radius: 8px;
            background-color: white;
            border: 1px solid #e2e8f0;
        }
        
        .subject-checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .subject-checkbox-item label {
            font-weight: normal;
            cursor: pointer;
            flex: 1;
        }
        
        .batch-submit-btn {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .batch-submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(66, 153, 225, 0.3);
        }
        
        /* ç§‘ç›®ç®¡ç†è¡¨å• */
        .subject-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .color-preview {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
        }
        
        .subject-submit-btn {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .subject-submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(72, 187, 120, 0.3);
        }
        
        /* å·²æœ‰ç§‘ç›®åˆ—è¡¨ */
        .existing-subjects {
            margin-top: 30px;
        }
        
        .existing-subjects h3 {
            font-size: 1.3rem;
            color: #2d3748;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .subject-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
        }
        
        .subject-list-item {
            background-color: #f8f9fa;
            padding: 12px 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-left: 4px solid;
        }
        
        .subject-list-item span {
            font-weight: 600;
        }
        
        .subject-list-item button {
            background: none;
            border: none;
            color: #e53e3e;
            cursor: pointer;
            font-size: 0.9rem;
            padding: 5px;
        }
        
        /* åŠ åˆ†å†å²è®°å½• */
        .history-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .history-item {
            background-color: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid #4299e1;
        }
        
        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .history-date {
            font-size: 0.9rem;
            color: #718096;
        }
        
        .history-score {
            font-weight: bold;
            color: #48bb78;
        }
        
        .history-subjects {
            font-size: 0.95rem;
            color: #4a5568;
            line-height: 1.5;
        }
        
        .history-reason {
            font-size: 0.9rem;
            color: #718096;
            font-style: italic;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #e2e8f0;
        }
        
        .no-history {
            text-align: center;
            padding: 40px;
            color: #718096;
        }
        
        /* ç¤¼ç‰©å…‘æ¢æ¿å— */
        .gift-section {
            max-width: 1200px;
            margin: 60px auto;
            background: white;
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            width: 100%;
        }
        
        .gift-section::before {
            content: "ğŸ";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 10rem;
            opacity: 0.05;
            z-index: 0;
        }
        
        .gift-section h2 {
            font-size: 2rem;
            color: #2d3748;
            margin-bottom: 30px;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 3px solid #fdf2f8;
            position: relative;
            z-index: 1;
        }
        
        .gift-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 20px;
            position: relative;
            z-index: 1;
        }
        
        .add-gift-btn {
            background: linear-gradient(135deg, #9f7aea, #805ad5);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(159, 122, 234, 0.3);
        }
        
        .add-gift-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(159, 122, 234, 0.4);
        }
        
        .total-crowns {
            font-size: 1.5rem;
            color: #ed8936;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 12px;
            background-color: #fffaf0;
            padding: 15px 25px;
            border-radius: 15px;
            border: 2px solid #fed7aa;
        }
        
        .gift-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            position: relative;
            z-index: 1;
        }
        
        /* ç¤¼ç‰©å¡ç‰‡ */
        .gift-card {
            background: white;
            border-radius: 18px;
            padding: 25px;
            border-left: 6px solid var(--gift-color);
            position: relative;
            transition: all 0.4s ease;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            border: 2px solid #f1f5f9;
        }
        
        .gift-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            border-color: var(--gift-color);
        }
        
        .gift-card.exchanged {
            opacity: 0.7;
            background: linear-gradient(135deg, #f7fafc, #edf2f7);
        }
        
        .gift-card.exchanged::after {
            content: "âœ… å·²å…‘æ¢";
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(72, 187, 120, 0.3);
        }
        
        .gift-name {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .gift-cost {
            font-size: 1.2rem;
            color: #4a5568;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .gift-desc {
            font-size: 1rem;
            color: #718096;
            margin-bottom: 20px;
            line-height: 1.6;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 3px solid var(--gift-color);
        }
        
        .gift-actions {
            display: flex;
            gap: 12px;
        }
        
        .exchange-gift-btn {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .exchange-gift-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(72, 187, 120, 0.3);
        }
        
        .exchange-gift-btn:disabled {
            background: linear-gradient(135deg, #a0aec0, #718096);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .delete-gift-btn {
            background: linear-gradient(135deg, #e53e3e, #c53030);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 80px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .delete-gift-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(229, 62, 62, 0.3);
        }
        
        /* ç¤¼ç‰©é…è‰² */
        .gift-card.color-1 { --gift-color: #4299e1; }
        .gift-card.color-2 { --gift-color: #9f7aea; }
        .gift-card.color-3 { --gift-color: #38b2ac; }
        .gift-card.color-4 { --gift-color: #48bb78; }
        .gift-card.color-5 { --gift-color: #ed8936; }
        .gift-card.color-6 { --gift-color: #e53e3e; }
        
        /* è£èª‰è¯ä¹¦åŒºåŸŸ */
        .certificate-section {
            text-align: center;
            margin: 60px 0;
            width: 100%;
        }
        
        .certificate-section h2 {
            font-size: 2rem;
            color: #2d3748;
            margin-bottom: 30px;
            position: relative;
            display: inline-block;
        }
        
        .certificate-section h2::after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, #9f7aea, #4299e1);
            border-radius: 2px;
        }
        
        .generate-cert-btn {
            background: linear-gradient(135deg, #9f7aea, #805ad5);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 30px;
            font-weight: 600;
            box-shadow: 0 8px 25px rgba(159, 122, 234, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .generate-cert-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(159, 122, 234, 0.4);
        }
        
        .certificate-preview {
            max-width: 900px;
            margin: 30px auto;
            background-color: white;
            border-radius: 20px;
            padding: 0;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
            display: none;
            overflow: hidden;
            border: 5px solid white;
            width: 100%;
        }
        
        /* å¥–çŠ¶èƒŒæ™¯æ ·å¼ */
        .certificate-bg {
            background: linear-gradient(135deg, #fff8e6 0%, #fff3e0 100%);
            border: 15px solid #ffc107;
            border-radius: 15px;
            padding: 60px;
            position: relative;
            text-align: center;
            min-height: 700px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
        }
        
        /* å¥–çŠ¶è£…é¥°å…ƒç´  */
        .certificate-bg::before,
        .certificate-bg::after {
            content: "ğŸ†";
            font-size: 60px;
            position: absolute;
            top: 30px;
            opacity: 0.3;
            animation: rotate 20s linear infinite;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .certificate-bg::before {
            left: 30px;
        }
        
        .certificate-bg::after {
            right: 30px;
        }
        
        .certificate-seal {
            position: absolute;
            bottom: 40px;
            right: 40px;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: radial-gradient(circle, #e53e3e 0%, #c53030 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(229, 62, 62, 0.3);
            flex-direction: column;
            line-height: 1.4;
            border: 5px solid white;
        }
        
        .certificate-title {
            font-family: "SimHei", "Microsoft YaHei", sans-serif;
            font-size: 48px;
            color: #d63384;
            margin-bottom: 30px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.1);
            letter-spacing: 10px;
            position: relative;
            display: inline-block;
        }
        
        .certificate-title::before, .certificate-title::after {
            content: "âœ¨";
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 30px;
        }
        
        .certificate-title::before {
            left: -50px;
        }
        
        .certificate-title::after {
            right: -50px;
        }
        
        .certificate-subtitle {
            font-size: 22px;
            color: #4a5568;
            margin-bottom: 50px;
            font-weight: normal;
            font-style: italic;
        }
        
        .certificate-avatar {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            border: 10px solid white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin: 0 auto 40px;
            object-fit: cover;
        }
        
        .certificate-content {
            font-size: 22px;
            line-height: 1.8;
            color: #2d3748;
            margin-bottom: 50px;
            text-align: left;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            background-color: rgba(255,255,255,0.8);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        }
        
        .certificate-total {
            font-size: 28px;
            font-weight: bold;
            color: #ed8936;
            margin: 30px 0;
            text-align: center;
            background: linear-gradient(135deg, #fffaf0, #feebc8);
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #fed7aa;
        }
        
        .certificate-footer {
            margin-top: 50px;
            font-size: 18px;
            color: #718096;
            font-style: italic;
            border-top: 2px dashed #e2e8f0;
            padding-top: 20px;
        }
        
        /* ç§¯åˆ†è§„åˆ™åŒºåŸŸ */
        .rule-section {
            max-width: 900px;
            margin: 60px auto;
            background: white;
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            width: 100%;
        }
        
        .rule-section::before {
            content: "ğŸ“š";
            position: absolute;
            bottom: -30px;
            left: -30px;
            font-size: 10rem;
            opacity: 0.05;
            z-index: 0;
        }
        
        .rule-section h2 {
            font-size: 2rem;
            color: #2d3748;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        .rule-list {
            list-style-type: none;
            padding-left: 0;
            color: #4a5568;
            line-height: 1.8;
            font-size: 1.1rem;
            position: relative;
            z-index: 1;
        }
        
        .rule-list li {
            margin-bottom: 20px;
            padding-left: 35px;
            position: relative;
        }
        
        .rule-list li::before {
            content: "âœ“";
            position: absolute;
            left: 0;
            top: 0;
            width: 25px;
            height: 25px;
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* åº•éƒ¨ç‰ˆæƒæ  */
        .footer {
            text-align: center;
            padding: 30px;
            margin-top: 60px;
            background: linear-gradient(135deg, #e8f4f8, #fdf2f8);
            border-radius: 25px;
            color: #718096;
            font-size: 0.9rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            width: 100%;
        }
        
        /* ç§‘ç›®é…è‰²å˜é‡ - åŠ¨æ€ç”Ÿæˆ */
        .card-color-0 {
            --title-color: #4299e1;
            --num-color: #4299e1;
            --star-color: #4299e1;
            --btn-primary: #4299e1;
            --btn-hover: #3182ce;
            --btn-secondary: #90cdf4;
            --btn-secondary-hover: #63b3ed;
        }
        
        .card-color-1 {
            --title-color: #38b2ac;
            --num-color: #38b2ac;
            --star-color: #38b2ac;
            --btn-primary: #38b2ac;
            --btn-hover: #319795;
            --btn-secondary: #7dd3d1;
            --btn-secondary-hover: #68d3cf;
        }
        
        .card-color-2 {
            --title-color: #ed8936;
            --num-color: #ed8936;
            --star-color: #ed8936;
            --btn-primary: #ed8936;
            --btn-hover: #dd6b20;
            --btn-secondary: #f6ad55;
            --btn-secondary-hover: #f59e0b;
        }
        
        .card-color-3 {
            --title-color: #48bb78;
            --num-color: #48bb78;
            --star-color: #48bb78;
            --btn-primary: #48bb78;
            --btn-hover: #38a169;
            --btn-secondary: #86d9a3;
            --btn-secondary-hover: #6fcf97;
        }
        
        .card-color-4 {
            --title-color: #9f7aea;
            --num-color: #9f7aea;
            --star-color: #9f7aea;
            --btn-primary: #9f7aea;
            --btn-hover: #805ad5;
            --btn-secondary: #c7a8e4;
            --btn-secondary-hover: #b490d4;
        }
        
        .card-color-5 {
            --title-color: #e53e3e;
            --num-color: #e53e3e;
            --star-color: #e53e3e;
            --btn-primary: #e53e3e;
            --btn-hover: #c53030;
            --btn-secondary: #f56565;
            --btn-secondary-hover: #e53e3e;
        }
        
        .card-color-6 {
            --title-color: #d69e2e;
            --num-color: #d69e2e;
            --star-color: #d69e2e;
            --btn-primary: #d69e2e;
            --btn-hover: #b7791f;
            --btn-secondary: #f6e05e;
            --btn-secondary-hover: #ecc94b;
        }
        
        .card-color-7 {
            --title-color: #ed64a6;
            --num-color: #ed64a6;
            --star-color: #ed64a6;
            --btn-primary: #ed64a6;
            --btn-hover: #d53f8c;
            --btn-secondary: #fbb6ce;
            --btn-secondary-hover: #f687b3;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1024px) {
            .card-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .card-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .btn-bar {
                flex-direction: column;
                align-items: center;
            }
            
            .btn-bar button {
                width: 250px;
            }
            
            .section-title {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .section-title .add-subject-btn {
                align-self: flex-end;
            }
            
            .gift-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .certificate-bg {
                padding: 30px;
                min-height: 500px;
            }
            
            .certificate-title {
                font-size: 32px;
                letter-spacing: 5px;
            }
            
            .certificate-content {
                font-size: 18px;
                padding: 20px;
            }
            
            .certificate-seal {
                width: 100px;
                height: 100px;
                font-size: 12px;
                bottom: 20px;
                right: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .header {
                padding: 25px 20px;
            }
            
            .subject-card {
                padding: 20px;
            }
            
            .avatar {
                width: 80px;
                height: 80px;
            }
            
            .header .crown-icon {
                position: static;
                margin-top: 10px;
                font-size: 2rem;
            }
            
            .certificate-preview {
                padding: 0;
                margin: 0 10px;
            }
            
            .certificate-bg {
                border-width: 8px;
                padding: 20px;
                min-height: 400px;
            }
            
            .certificate-title {
                font-size: 24px;
                letter-spacing: 3px;
            }
            
            .certificate-avatar {
                width: 120px;
                height: 120px;
            }
            
            .subject-modal-content, .batch-modal-content, .history-modal-content {
                padding: 20px;
            }
            
            .gift-section, .rule-section {
                padding: 25px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
        <div class="header">
            <!-- å¤´åƒåŒºåŸŸ -->
            <div class="avatar-container">
                <img src="https://via.placeholder.com/100/4299e1/ffffff?text=Susan" alt="Susanå¤´åƒ" class="avatar" id="avatarImg">
                <div class="avatar-upload" onclick="document.getElementById('avatarInput').click()">
                    <i class="fas fa-camera"></i>
                </div>
                <input type="file" id="avatarInput" accept="image/*" onchange="uploadAvatar()">
            </div>
            
            <h1>Susanæ˜Ÿæ˜Ÿå¤§ä½œæˆ˜</h1>
            <p>æ¯ä¸€é¢—æ˜Ÿæ˜Ÿï¼Œéƒ½æ˜¯æˆé•¿çš„è¶³è¿¹</p>
            <div class="date" id="currentDate">2025å¹´09æœˆ17æ—¥ æ˜ŸæœŸä¸‰</div>
            <div class="crown-icon">ğŸ‘‘</div>
        </div>
        
        <!-- åŠŸèƒ½æŒ‰é’® -->
        <div class="btn-bar">
            <button class="save-btn" onclick="saveAllData()">
                <i class="fas fa-save"></i>æ‰‹åŠ¨ä¿å­˜æ•°æ®
            </button>
            <button class="reset-btn" onclick="resetAllData()">
                <i class="fas fa-redo"></i>é‡ç½®æ‰€æœ‰æ•°æ®
            </button>
            <button class="manage-subject-btn" onclick="openSubjectModal()">
                <i class="fas fa-plus-circle"></i>ç®¡ç†ç§‘ç›®
            </button>
            <button class="batch-all-btn" onclick="openBatchModal()">
                <i class="fas fa-bolt"></i>æ‰¹é‡åŠ åˆ†
            </button>
            <button class="view-history-btn" onclick="openHistoryModal()">
                <i class="fas fa-history"></i>åŠ åˆ†è®°å½•
            </button>
            <button class="import-export-btn" onclick="showImportExportOptions()">
                <i class="fas fa-file-export"></i>å¯¼å…¥/å¯¼å‡º
            </button>
        </div>
        
        <!-- å­¦ä¹ ç§‘ç›®æ¿å— -->
        <h2 class="section-title">
            <span>å­¦ä¹ ç§‘ç›®</span>
            <button class="add-subject-btn" onclick="openSubjectModal()">
                <i class="fas fa-plus"></i>æ·»åŠ ç§‘ç›®
            </button>
        </h2>
        <div class="card-grid" id="learningSubjectsGrid">
            <!-- ç§‘ç›®å¡ç‰‡åŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <!-- å®¶åº­è¡¨ç°æ¿å— -->
        <h2 class="section-title">
            <span>å®¶åº­è¡¨ç°</span>
            <button class="add-subject-btn" onclick="openSubjectModal()">
                <i class="fas fa-plus"></i>æ·»åŠ ç§‘ç›®
            </button>
        </h2>
        <div class="card-grid" id="homeSubjectsGrid">
            <!-- ç§‘ç›®å¡ç‰‡åŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <!-- æ‰¹é‡åŠ åˆ†æ¨¡æ€æ¡† -->
        <div class="batch-modal" id="batchModal">
            <div class="batch-modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-bolt"></i> æ‰¹é‡åŠ åˆ†</h2>
                    <button class="close-modal" onclick="closeBatchModal()">&times;</button>
                </div>
                
                <form class="batch-form" id="batchForm">
                    <div class="form-group">
                        <label for="batchScore">åŠ åˆ†æ•°é‡</label>
                        <input type="number" id="batchScore" min="1" max="100" value="5" required>
                    </div>
                    
                    <div class="form-group">
                        <label>é€‰æ‹©ç§‘ç›®</label>
                        <div class="subject-checkboxes" id="subjectCheckboxes">
                            <!-- ç§‘ç›®å¤é€‰æ¡†åŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="batchReason">åŠ åˆ†åŸå› ï¼ˆå¯é€‰ï¼‰</label>
                        <textarea id="batchReason" rows="3" placeholder="ä¾‹å¦‚ï¼šæœ¬å‘¨è¡¨ç°è‰¯å¥½ï¼Œç‰¹æ­¤å¥–åŠ±"></textarea>
                    </div>
                    
                    <button type="submit" class="batch-submit-btn">
                        <i class="fas fa-check"></i> ç¡®è®¤æ‰¹é‡åŠ åˆ†
                    </button>
                </form>
            </div>
        </div>
        
        <!-- ç§‘ç›®ç®¡ç†æ¨¡æ€æ¡† -->
        <div class="subject-modal" id="subjectModal">
            <div class="subject-modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-book"></i> ç§‘ç›®ç®¡ç†</h2>
                    <button class="close-modal" onclick="closeSubjectModal()">&times;</button>
                </div>
                
                <form class="subject-form" id="subjectForm">
                    <div class="form-group">
                        <label for="subjectName">ç§‘ç›®åç§°</label>
                        <input type="text" id="subjectName" placeholder="ä¾‹å¦‚ï¼šé’¢ç´ç»ƒä¹ " required>
                    </div>
                    
                    <div class="form-group">
                        <label for="subjectCategory">æ‰€å±åˆ†ç±»</label>
                        <select id="subjectCategory" required>
                            <option value="">é€‰æ‹©åˆ†ç±»</option>
                            <option value="learning">å­¦ä¹ ç§‘ç›®</option>
                            <option value="home">å®¶åº­è¡¨ç°</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="subjectColor">ä¸»é¢˜é¢œè‰²</label>
                        <select id="subjectColor" onchange="updateColorPreview()">
                            <option value="0">è“è‰² (#4299e1)</option>
                            <option value="1">é’è‰² (#38b2ac)</option>
                            <option value="2">æ©™è‰² (#ed8936)</option>
                            <option value="3">ç»¿è‰² (#48bb78)</option>
                            <option value="4">ç´«è‰² (#9f7aea)</option>
                            <option value="5">çº¢è‰² (#e53e3e)</option>
                            <option value="6">é‡‘è‰² (#d69e2e)</option>
                            <option value="7">ç²‰è‰² (#ed64a6)</option>
                        </select>
                        <div class="color-preview" id="colorPreview"></div>
                    </div>
                    
                    <button type="submit" class="subject-submit-btn">
                        <i class="fas fa-check"></i> æ·»åŠ ç§‘ç›®
                    </button>
                </form>
                
                <div class="existing-subjects">
                    <h3>å·²æœ‰ç§‘ç›®</h3>
                    <div class="subject-list" id="existingSubjectsList">
                        <!-- å·²æœ‰ç§‘ç›®åˆ—è¡¨åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å†å²è®°å½•æ¨¡æ€æ¡† -->
        <div class="history-modal" id="historyModal">
            <div class="history-modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-history"></i> åŠ åˆ†è®°å½•</h2>
                    <button class="close-modal" onclick="closeHistoryModal()">&times;</button>
                </div>
                
                <div class="history-list" id="historyList">
                    <!-- å†å²è®°å½•åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
        
        <!-- ç¤¼ç‰©å…‘æ¢æ¿å— -->
        <div class="gift-section">
            <h2>çš‡å† å…‘æ¢ç¤¼ç‰©ä¸­å¿ƒ</h2>
            <div class="gift-controls">
                <button class="add-gift-btn" onclick="addNewGift()">
                    <i class="fas fa-gift"></i>æ·»åŠ æ–°ç¤¼ç‰©
                </button>
                <div class="total-crowns" id="totalCrowns">
                    <span>ğŸ‘‘</span>
                    <span>å½“å‰æ€»çš‡å† æ•°ï¼š0</span>
                </div>
            </div>
            <div class="gift-grid" id="giftGrid">
                <!-- ç¤¼ç‰©å¡ç‰‡åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- è£èª‰è¯ä¹¦åŒºåŸŸ -->
        <div class="certificate-section">
            <h2>è£èª‰è¯ä¹¦</h2>
            <button class="generate-cert-btn" onclick="generateCertificate()">
                <i class="fas fa-certificate"></i>ç”Ÿæˆå½“å‰æ˜Ÿæ˜Ÿè£èª‰å›¾
            </button>
            <div class="certificate-preview" id="certificatePreview">
                <!-- è£èª‰è¯ä¹¦å†…å®¹åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- ç§¯åˆ†è§„åˆ™åŒºåŸŸ -->
        <div class="rule-section">
            <h2>ç§¯åˆ†è§„åˆ™</h2>
            <ul class="rule-list">
                <li>æ¯å®Œæˆä¸€é¡¹ä»»åŠ¡ï¼ŒåŠ ä¸€ä¸ªç§¯åˆ†ï¼ˆæ˜Ÿæ˜Ÿï¼‰</li>
                <li>æœªå®Œæˆä»»åŠ¡ï¼Œæ‰£ä¸€ä¸ªç§¯åˆ†ï¼ˆæ˜Ÿæ˜Ÿï¼‰ï¼›å…‘æ¢çš‡å† åæ˜Ÿæ˜Ÿæ•°ä¸º0æ—¶å‡åˆ†ï¼Œä¼šå–æ¶ˆè¯¥çš‡å† å¹¶æ¢å¤æ˜Ÿæ˜Ÿæ•°ä¸º9</li>
                <li>ç´¯è®¡10ä¸ªç§¯åˆ†ï¼ˆæ˜Ÿæ˜Ÿï¼‰è‡ªåŠ¨å…‘æ¢ä¸€ä¸ªçš‡å† ï¼Œæ˜Ÿæ˜Ÿæ•°æ¸…é›¶</li>
                <li>çš‡å† å¯ç”¨äºå…‘æ¢å¥–åŠ±ï¼ˆç”±å®¶é•¿è®¾å®šï¼‰ï¼Œå…‘æ¢åç¤¼ç‰©æ ‡è®°ä¸ºå·²å…‘æ¢</li>
                <li>ç³»ç»Ÿä¼šè‡ªåŠ¨ä¿å­˜æ‰€æœ‰æ•°æ®ï¼Œä¸‹æ¬¡æ‰“å¼€æ—¶æ˜¾ç¤ºæœ€æ–°æ•°æ®</li>
                <li>å¯ä»¥è‡ªå®šä¹‰æ·»åŠ ç§‘ç›®å’Œç¤¼ç‰©ï¼Œä¸ªæ€§åŒ–è®¾ç½®å¥–åŠ±ç³»ç»Ÿ</li>
            </ul>
        </div>
        
        <!-- åº•éƒ¨ç‰ˆæƒæ  -->
        <div class="footer">
            <p>Susanæ˜Ÿæ˜Ÿå¤§ä½œæˆ˜ Â© 2025 | æ¯é¢—æ˜Ÿæ˜Ÿä»£è¡¨ä¸€æ¬¡åŠªåŠ›çš„æˆæœ</p>
            <p>å„é¡¹ç´¯è®¡10é¢—æ˜Ÿæ˜Ÿï¼Œå‡å¯å…‘æ¢å¯¹åº”é¢œè‰²çš‡å† ï¼</p>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–ç§‘ç›®æ•°æ®
        let subjects = [];
        let subjectColors = [
            "#4299e1", "#38b2ac", "#ed8936", "#48bb78", 
            "#9f7aea", "#e53e3e", "#d69e2e", "#ed64a6"
        ];
        
        // å­˜å‚¨ç§‘ç›®ç§¯åˆ†å’Œçš‡å† æ•°æ®
        let scoreData = {};
        let crownData = {};
        // å¤´åƒæ•°æ®
        let avatarData = "";
        // çš‡å† å…‘æ¢é˜ˆå€¼
        const exchangeThreshold = 10;
        // ç¤¼ç‰©æ•°æ®
        let giftData = [];
        // ç¤¼ç‰©é…è‰²åˆ—è¡¨
        const giftColors = ['color-1', 'color-2', 'color-3', 'color-4', 'color-5', 'color-6'];
        // åŠ åˆ†å†å²è®°å½•
        let historyData = [];
        
        // åˆå§‹åŒ–æ•°æ®
        function initData() {
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½ç§‘ç›®æ•°æ®
            loadSubjects();
            
            // å¦‚æœæœ¬åœ°æ²¡æœ‰ç§‘ç›®æ•°æ®ï¼Œåˆå§‹åŒ–é»˜è®¤ç§‘ç›®
            if (subjects.length === 0) {
                subjects = [
                    { id: 1, name: "å¤è¯—", category: "learning", color: 0 },
                    { id: 2, name: "æ•°å­¦", category: "learning", color: 1 },
                    { id: 3, name: "è‹±è¯­", category: "learning", color: 2 },
                    { id: 4, name: "è¿åŠ¨èˆè¹ˆ", category: "learning", color: 3 },
                    { id: 5, name: "å®¶åŠ¡åŠ³åŠ¨", category: "home", color: 0 },
                    { id: 6, name: "è‡ªä¸»å­¦ä¹ ", category: "home", color: 4 },
                    { id: 7, name: "æ”¶æ‹¾ä¹¦æ¡Œ", category: "home", color: 5 },
                    { id: 8, name: "æ•´ç†ä¹¦åŒ…", category: "home", color: 3 }
                ];
                saveSubjects();
            }
            
            // åˆå§‹åŒ–ç§¯åˆ†æ•°æ®
            subjects.forEach(subject => {
                scoreData[subject.id] = 0;
                crownData[subject.id] = { total: 0, exchanged: 0 };
            });
            
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
            loadData();
            // åŠ è½½å¤´åƒ
            loadAvatar();
            // åŠ è½½ç¤¼ç‰©æ•°æ®
            loadGiftData();
            // åŠ è½½å†å²è®°å½•
            loadHistoryData();
            // æ›´æ–°æ—¥æœŸ
            updateDate();
            // æ¸²æŸ“æ‰€æœ‰å¡ç‰‡
            renderAllCards();
            // æ¸²æŸ“ç¤¼ç‰©åˆ—è¡¨
            renderGiftList();
            // æ›´æ–°æ€»çš‡å† æ•°
            updateTotalCrowns();
            // åˆå§‹åŒ–é¢œè‰²é¢„è§ˆ
            updateColorPreview();
            
            // è®¾ç½®è‡ªåŠ¨ä¿å­˜ï¼ˆæ¯30ç§’ï¼‰
            setInterval(() => {
                saveAllData();
            }, 30000);
        }
        
        // æ›´æ–°å½“å‰æ—¥æœŸ
        function updateDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const weekDays = ["æ˜ŸæœŸæ—¥", "æ˜ŸæœŸä¸€", "æ˜ŸæœŸäºŒ", "æ˜ŸæœŸä¸‰", "æ˜ŸæœŸå››", "æ˜ŸæœŸäº”", "æ˜ŸæœŸå…­"];
            const weekDay = weekDays[now.getDay()];
            document.getElementById("currentDate").textContent = `${year}å¹´${month}æœˆ${day}æ—¥ ${weekDay}`;
        }
        
        // ä¸Šä¼ å¤´åƒ
        function uploadAvatar() {
            const input = document.getElementById('avatarInput');
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // æ˜¾ç¤ºå¤´åƒ
                    document.getElementById('avatarImg').src = e.target.result;
                    // ä¿å­˜å¤´åƒæ•°æ®
                    avatarData = e.target.result;
                    saveAvatar();
                    // æ¸…ç©ºinputå€¼ï¼Œæ”¯æŒé‡å¤ä¸Šä¼ åŒä¸€å¼ å›¾ç‰‡
                    input.value = '';
                }
                reader.readAsDataURL(file);
            }
        }
        
        // ä¿å­˜å¤´åƒåˆ°æœ¬åœ°å­˜å‚¨
        function saveAvatar() {
            localStorage.setItem("susanAvatar", avatarData);
        }
        
        // åŠ è½½æœ¬åœ°å­˜å‚¨çš„å¤´åƒ
        function loadAvatar() {
            const savedAvatar = localStorage.getItem("susanAvatar");
            if (savedAvatar) {
                avatarData = savedAvatar;
                document.getElementById('avatarImg').src = savedAvatar;
            }
        }
        
        // ä¿å­˜ç§‘ç›®æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveSubjects() {
            localStorage.setItem("susanSubjects", JSON.stringify(subjects));
        }
        
        // åŠ è½½ç§‘ç›®æ•°æ®
        function loadSubjects() {
            const savedSubjects = localStorage.getItem("susanSubjects");
            if (savedSubjects) {
                subjects = JSON.parse(savedSubjects);
            }
        }
        
        // ä¿å­˜å†å²è®°å½•åˆ°æœ¬åœ°å­˜å‚¨
        function saveHistoryData() {
            localStorage.setItem("susanHistoryData", JSON.stringify(historyData));
        }
        
        // åŠ è½½å†å²è®°å½•
        function loadHistoryData() {
            const savedHistoryData = localStorage.getItem("susanHistoryData");
            if (savedHistoryData) {
                historyData = JSON.parse(savedHistoryData);
            } else {
                historyData = [];
            }
        }
        
        // æ·»åŠ å†å²è®°å½•
        function addHistoryRecord(score, selectedSubjects, reason) {
            const now = new Date();
            const record = {
                id: Date.now(),
                date: now.toLocaleString('zh-CN'),
                score: score,
                subjects: selectedSubjects,
                reason: reason || "æ— åŸå› è¯´æ˜"
            };
            
            // æ·»åŠ åˆ°å†å²è®°å½•æ•°ç»„å¼€å¤´ï¼ˆæœ€æ–°è®°å½•åœ¨å‰ï¼‰
            historyData.unshift(record);
            
            // é™åˆ¶æœ€å¤šä¿å­˜100æ¡è®°å½•
            if (historyData.length > 100) {
                historyData = historyData.slice(0, 100);
            }
            
            // ä¿å­˜å†å²è®°å½•
            saveHistoryData();
        }
        
        // æ›´æ”¹ç§‘ç›®ç§¯åˆ†
        function changeScore(subjectId, amount, isBatch = false, batchReason = "") {
            const subject = subjects.find(s => s.id === subjectId);
            if (!subject) return;
            
            // æ ‡è®°æ˜¯å¦æ˜¯ã€Œå…‘æ¢çš‡å† åæ˜Ÿæ˜Ÿæ•°ä¸º0ã€çš„å‡åˆ†åœºæ™¯
            const isExchangeZeroMinus = (scoreData[subjectId] === 0 && amount < 0 && crownData[subjectId].exchanged > 0);
            
            // æ­£å¸¸å‡åˆ†ï¼šé˜²æ­¢è´Ÿæ•°ï¼›å…‘æ¢åå‡åˆ†ï¼šå…è®¸çªç ´æ ¡éªŒ
            if (!isExchangeZeroMinus && scoreData[subjectId] + amount < 0) {
                if (!isBatch) {
                    alert(`ä¸èƒ½å†å‡åˆ†å•¦ï¼Œ${subject.name}çš„æ˜Ÿæ˜Ÿæ•°é‡ä¸èƒ½ä¸ºè´Ÿæ•°ï¼`);
                }
                return;
            }

            // å…ˆè®°å½•å½“å‰çŠ¶æ€ï¼ˆç”¨äºå‡åˆ†å›é€€çš‡å† ï¼‰
            const prevScore = scoreData[subjectId];
            const prevCrownExchanged = crownData[subjectId].exchanged;
            
            // ç‰¹æ®Šå¤„ç†ï¼šå…‘æ¢åæ˜Ÿæ˜Ÿæ•°ä¸º0æ—¶å‡åˆ†ï¼Œç›´æ¥è®¾ç½®æ˜Ÿæ˜Ÿæ•°ä¸º9ï¼Œä¸æ‰§è¡Œæ™®é€šå‡åˆ†
            if (isExchangeZeroMinus) {
                scoreData[subjectId] = 9; // å¼ºåˆ¶æ¢å¤ä¸º9
                // è§¦å‘çš‡å† å›é€€
                checkCrownReduction(subjectId, prevScore, prevCrownExchanged);
            } else {
                // æ™®é€šåŠ å‡åˆ†æ“ä½œ
                scoreData[subjectId] += amount;

                // åŠ åˆ†æ—¶ï¼šæ£€æŸ¥æ˜¯å¦å…‘æ¢æ–°çš‡å† 
                if (amount > 0) {
                    checkCrownExchange(subjectId);
                } 
                // æ™®é€šå‡åˆ†æ—¶ï¼šæ— éœ€å¤„ç†çš‡å† ï¼ˆéå…‘æ¢ååœºæ™¯ï¼‰
            }

            // å¦‚æœæ˜¯æ‰¹é‡åŠ åˆ†ï¼Œä¸å•ç‹¬ä¿å­˜è®°å½•
            if (isBatch && amount > 0) {
                // æ‰¹é‡åŠ åˆ†çš„è®°å½•åœ¨æ‰¹é‡åŠ åˆ†å‡½æ•°ä¸­ç»Ÿä¸€æ·»åŠ 
            } else if (!isBatch && amount !== 0) {
                // å•ç‹¬åŠ åˆ†/å‡åˆ†çš„è®°å½•
                const action = amount > 0 ? "åŠ åˆ†" : "å‡åˆ†";
                const record = {
                    id: Date.now(),
                    date: new Date().toLocaleString('zh-CN'),
                    score: Math.abs(amount),
                    subjects: [subject.name],
                    reason: `${action}æ“ä½œ`
                };
                historyData.unshift(record);
                if (historyData.length > 100) historyData = historyData.slice(0, 100);
                saveHistoryData();
            }

            // æ¸²æŸ“å½“å‰å¡ç‰‡
            renderCard(subjectId);
            // æ›´æ–°æ€»çš‡å† æ•°
            updateTotalCrowns();
            // æ›´æ–°ç¤¼ç‰©æŒ‰é’®çŠ¶æ€
            updateGiftButtons();
            // ä¿å­˜æ•°æ®
            saveAllData();
        }
        
        // æ£€æŸ¥çš‡å† å…‘æ¢é€»è¾‘
        function checkCrownExchange(subjectId) {
            if (scoreData[subjectId] >= exchangeThreshold) {
                const crownNum = Math.floor(scoreData[subjectId] / exchangeThreshold);
                crownData[subjectId].total += crownNum;
                crownData[subjectId].exchanged += crownNum;
                scoreData[subjectId] = scoreData[subjectId] % exchangeThreshold;
                
                const subject = subjects.find(s => s.id === subjectId);
                alert(`${subject.name}ï¼šç´¯è®¡${exchangeThreshold*crownNum}é¢—æ˜Ÿæ˜Ÿï¼Œè‡ªåŠ¨å…‘æ¢${crownNum}ä¸ªçš‡å† ï¼`);
            }
        }

        // å‡åˆ†æ—¶æ£€æŸ¥çš‡å† å›é€€é€»è¾‘
        function checkCrownReduction(subjectId, prevScore, prevCrownExchanged) {
            // ä»…å¤„ç†ã€Œå…‘æ¢åæ˜Ÿæ˜Ÿæ•°ä¸º0ã€çš„å‡åˆ†åœºæ™¯
            if (prevScore === 0 && crownData[subjectId].exchanged > 0) {
                // å›é€€1ä¸ªå·²å…‘æ¢çš‡å† 
                crownData[subjectId].exchanged -= 1;
                crownData[subjectId].total -= 1; // æ€»çš‡å† æ•°ä¹Ÿå›é€€
                
                const subject = subjects.find(s => s.id === subjectId);
                alert(`${subject.name}ï¼šå› å‡åˆ†ï¼Œå·²å–æ¶ˆ1ä¸ªçš‡å† å…‘æ¢ï¼Œæ˜Ÿæ˜Ÿæ•°æ¢å¤ä¸º9ï¼`);
            }
        }
        
        // æ¸²æŸ“å•ä¸ªç§‘ç›®å¡ç‰‡
        function renderCard(subjectId) {
            const subject = subjects.find(s => s.id === subjectId);
            if (!subject) return;
            
            const card = document.getElementById(`card-${subjectId}`);
            if (!card) return;
            
            // æ›´æ–°ç§¯åˆ†æ•°å­—
            document.getElementById(`score-${subjectId}`).textContent = scoreData[subjectId];
            
            // ç”Ÿæˆæ˜Ÿæ˜Ÿ
            const starsContainer = document.getElementById(`stars-${subjectId}`);
            if (starsContainer) {
                starsContainer.innerHTML = "";
                // æœ€å¤šæ˜¾ç¤º10é¢—æ˜Ÿæ˜Ÿï¼Œè¶…è¿‡åˆ™åªæ˜¾ç¤ºéƒ¨åˆ†
                const displayStars = Math.min(scoreData[subjectId], 10);
                for (let i = 0; i < displayStars; i++) {
                    const star = document.createElement("span");
                    star.className = `star active`;
                    star.textContent = "â˜…";
                    starsContainer.appendChild(star);
                }
            }
            
            // æ›´æ–°çš‡å† ä¿¡æ¯
            const crownInfo = card.querySelector('.crown-info');
            if (crownInfo) {
                crownInfo.textContent = `çš‡å† : ${crownData[subjectId].exchanged} (å…±${crownData[subjectId].total}ä¸ª, å·²å…‘æ¢${crownData[subjectId].exchanged}ä¸ª)`;
            }
            
            // æ›´æ–°å…‘æ¢æç¤º
            const exchangeTip = card.querySelector('.exchange-tip');
            if (exchangeTip) {
                if (scoreData[subjectId] >= exchangeThreshold) {
                    exchangeTip.textContent = `å¯å…‘æ¢${Math.floor(scoreData[subjectId]/exchangeThreshold)}ä¸ªçš‡å† `;
                } else if (scoreData[subjectId] === 0 && crownData[subjectId].exchanged > 0) {
                    exchangeTip.textContent = `å·²å…‘æ¢çš‡å† ï¼Œæ˜Ÿæ˜Ÿæ•°æ¸…é›¶ï¼ˆå¯å‡åˆ†å–æ¶ˆçš‡å† ï¼‰`;
                } else if (scoreData[subjectId] === 0) {
                    exchangeTip.textContent = `æ— å¯å…‘æ¢çš‡å† `;
                } else {
                    exchangeTip.textContent = `è¿˜éœ€${exchangeThreshold - scoreData[subjectId]}é¢—æ˜Ÿæ˜Ÿå¯å…‘æ¢çš‡å† `;
                }
            }
        }
        
        // æ¸²æŸ“æ‰€æœ‰å¡ç‰‡
        function renderAllCards() {
            // æ¸…ç©ºç°æœ‰å¡ç‰‡
            document.getElementById("learningSubjectsGrid").innerHTML = "";
            document.getElementById("homeSubjectsGrid").innerHTML = "";
            
            // æ¸²æŸ“æ¯ä¸ªç§‘ç›®å¡ç‰‡
            subjects.forEach(subject => {
                const card = createSubjectCard(subject);
                
                // æ ¹æ®åˆ†ç±»æ·»åŠ åˆ°å¯¹åº”çš„ç½‘æ ¼
                if (subject.category === "learning") {
                    document.getElementById("learningSubjectsGrid").appendChild(card);
                } else if (subject.category === "home") {
                    document.getElementById("homeSubjectsGrid").appendChild(card);
                }
                
                // åˆå§‹åŒ–æ¸²æŸ“å¡ç‰‡å†…å®¹
                renderCard(subject.id);
            });
        }
        
        // åˆ›å»ºç§‘ç›®å¡ç‰‡å…ƒç´ 
        function createSubjectCard(subject) {
            const card = document.createElement('div');
            card.className = `subject-card card-color-${subject.color}`;
            card.id = `card-${subject.id}`;
            
            card.innerHTML = `
                <button class="delete-subject-btn" onclick="deleteSubject(${subject.id})" title="åˆ é™¤ç§‘ç›®">
                    <i class="fas fa-trash"></i>
                </button>
                <div class="subject-name">${subject.name}</div>
                <div class="score-num" id="score-${subject.id}">0</div>
                <div class="stars-container" id="stars-${subject.id}"></div>
                <div class="btn-group">
                    <button class="add-btn" onclick="changeScore(${subject.id}, 1)">
                        <i class="fas fa-plus"></i>åŠ åˆ†
                    </button>
                    <button class="minus-btn" onclick="changeScore(${subject.id}, -1)">
                        <i class="fas fa-minus"></i>å‡åˆ†
                    </button>
                </div>
                <div class="crown-info">çš‡å† : 0 (å…±0ä¸ª, å·²å…‘æ¢0ä¸ª)</div>
                <div class="exchange-tip" id="tip-${subject.id}">æ— å¯å…‘æ¢çš‡å† </div>
            `;
            
            return card;
        }
        
        // è®¡ç®—æ€»çš‡å† æ•°
        function calculateTotalCrowns() {
            let total = 0;
            subjects.forEach(subject => {
                total += crownData[subject.id].exchanged || 0;
            });
            return total;
        }
        
        // æ›´æ–°æ€»çš‡å† æ•°æ˜¾ç¤º
        function updateTotalCrowns() {
            const total = calculateTotalCrowns();
            document.getElementById('totalCrowns').innerHTML = `<span>ğŸ‘‘</span><span>å½“å‰æ€»çš‡å† æ•°ï¼š${total}</span>`;
        }
        
        // æ‰“å¼€æ‰¹é‡åŠ åˆ†æ¨¡æ€æ¡†
        function openBatchModal() {
            document.getElementById('batchModal').style.display = 'flex';
            renderSubjectCheckboxes();
        }
        
        // å…³é—­æ‰¹é‡åŠ åˆ†æ¨¡æ€æ¡†
        function closeBatchModal() {
            document.getElementById('batchModal').style.display = 'none';
            document.getElementById('batchForm').reset();
        }
        
        // æ¸²æŸ“ç§‘ç›®å¤é€‰æ¡†
        function renderSubjectCheckboxes() {
            const container = document.getElementById('subjectCheckboxes');
            container.innerHTML = '';
            
            subjects.forEach(subject => {
                const checkboxItem = document.createElement('div');
                checkboxItem.className = 'subject-checkbox-item';
                checkboxItem.innerHTML = `
                    <input type="checkbox" id="subject-${subject.id}" value="${subject.id}" checked>
                    <label for="subject-${subject.id}">${subject.name}</label>
                `;
                container.appendChild(checkboxItem);
            });
        }
        
        // æ‰“å¼€ç§‘ç›®ç®¡ç†æ¨¡æ€æ¡†
        function openSubjectModal() {
            document.getElementById('subjectModal').style.display = 'flex';
            renderExistingSubjectsList();
        }
        
        // å…³é—­ç§‘ç›®ç®¡ç†æ¨¡æ€æ¡†
        function closeSubjectModal() {
            document.getElementById('subjectModal').style.display = 'none';
            document.getElementById('subjectForm').reset();
        }
        
        // æ‰“å¼€å†å²è®°å½•æ¨¡æ€æ¡†
        function openHistoryModal() {
            document.getElementById('historyModal').style.display = 'flex';
            renderHistoryList();
        }
        
        // å…³é—­å†å²è®°å½•æ¨¡æ€æ¡†
        function closeHistoryModal() {
            document.getElementById('historyModal').style.display = 'none';
        }
        
        // æ¸²æŸ“å†å²è®°å½•åˆ—è¡¨
        function renderHistoryList() {
            const container = document.getElementById('historyList');
            
            if (historyData.length === 0) {
                container.innerHTML = `
                    <div class="no-history">
                        <i class="fas fa-history" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                        <p>æš‚æ— åŠ åˆ†è®°å½•</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">å¼€å§‹ä½¿ç”¨æ‰¹é‡åŠ åˆ†åŠŸèƒ½åï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºè®°å½•</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            historyData.forEach(record => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                // æ ¼å¼åŒ–ç§‘ç›®åˆ—è¡¨
                const subjectsText = record.subjects.join('ã€');
                
                historyItem.innerHTML = `
                    <div class="history-item-header">
                        <div class="history-date">
                            <i class="far fa-clock"></i> ${record.date}
                        </div>
                        <div class="history-score">
                            <i class="fas fa-star"></i> +${record.score} é¢—æ˜Ÿ
                        </div>
                    </div>
                    <div class="history-subjects">
                        <strong>åŠ åˆ†ç§‘ç›®ï¼š</strong>${subjectsText}
                    </div>
                    <div class="history-reason">
                        <strong>åŸå› ï¼š</strong>${record.reason}
                    </div>
                `;
                
                container.appendChild(historyItem);
            });
        }
        
        // æ›´æ–°é¢œè‰²é¢„è§ˆ
        function updateColorPreview() {
            const colorSelect = document.getElementById('subjectColor');
            const colorPreview = document.getElementById('colorPreview');
            const colorIndex = parseInt(colorSelect.value);
            colorPreview.style.backgroundColor = subjectColors[colorIndex];
        }
        
        // æ¸²æŸ“å·²æœ‰ç§‘ç›®åˆ—è¡¨
        function renderExistingSubjectsList() {
            const listContainer = document.getElementById('existingSubjectsList');
            listContainer.innerHTML = '';
            
            subjects.forEach(subject => {
                const listItem = document.createElement('div');
                listItem.className = 'subject-list-item';
                listItem.style.borderLeftColor = subjectColors[subject.color];
                
                listItem.innerHTML = `
                    <span>${subject.name}</span>
                    <button onclick="deleteSubject(${subject.id})" title="åˆ é™¤ç§‘ç›®">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                
                listContainer.appendChild(listItem);
            });
        }
        
        // æ‰¹é‡åŠ åˆ†è¡¨å•æäº¤
        document.getElementById('batchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const score = parseInt(document.getElementById('batchScore').value);
            const reason = document.getElementById('batchReason').value.trim();
            
            if (isNaN(score) || score <= 0) {
                alert("è¯·è¾“å…¥æœ‰æ•ˆçš„åŠ åˆ†æ•°é‡ï¼");
                return;
            }
            
            if (score > 100) {
                alert("æ‰¹é‡åŠ åˆ†æœ€å¤š100é¢—æ˜Ÿæ˜Ÿï¼");
                return;
            }
            
            // è·å–é€‰ä¸­çš„ç§‘ç›®
            const selectedCheckboxes = document.querySelectorAll('#subjectCheckboxes input[type="checkbox"]:checked');
            if (selectedCheckboxes.length === 0) {
                alert("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªç§‘ç›®ï¼");
                return;
            }
            
            const selectedSubjects = [];
            selectedCheckboxes.forEach(checkbox => {
                const subjectId = parseInt(checkbox.value);
                const subject = subjects.find(s => s.id === subjectId);
                if (subject) {
                    selectedSubjects.push(subject.name);
                    changeScore(subjectId, score, true, reason);
                }
            });
            
            // æ·»åŠ å†å²è®°å½•
            addHistoryRecord(score, selectedSubjects, reason);
            
            // å…³é—­æ¨¡æ€æ¡†å¹¶é‡ç½®è¡¨å•
            closeBatchModal();
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            alert(`æˆåŠŸä¸º ${selectedSubjects.length} ä¸ªç§‘ç›®æ·»åŠ  ${score} é¢—æ˜Ÿæ˜Ÿï¼`);
        });
        
        // æ·»åŠ æ–°ç§‘ç›®
        document.getElementById('subjectForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const subjectName = document.getElementById('subjectName').value.trim();
            const subjectCategory = document.getElementById('subjectCategory').value;
            const subjectColor = parseInt(document.getElementById('subjectColor').value);
            
            if (!subjectName || !subjectCategory) {
                alert("è¯·å¡«å†™ç§‘ç›®åç§°å¹¶é€‰æ‹©åˆ†ç±»ï¼");
                return;
            }
            
            // æ£€æŸ¥ç§‘ç›®æ˜¯å¦å·²å­˜åœ¨
            if (subjects.some(s => s.name === subjectName)) {
                alert("ç§‘ç›®åç§°å·²å­˜åœ¨ï¼Œè¯·ä½¿ç”¨å…¶ä»–åç§°ï¼");
                return;
            }
            
            // åˆ›å»ºæ–°ç§‘ç›®
            const newSubject = {
                id: Date.now(), // ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºå”¯ä¸€ID
                name: subjectName,
                category: subjectCategory,
                color: subjectColor
            };
            
            // æ·»åŠ åˆ°ç§‘ç›®åˆ—è¡¨
            subjects.push(newSubject);
            
            // åˆå§‹åŒ–ç§¯åˆ†æ•°æ®
            scoreData[newSubject.id] = 0;
            crownData[newSubject.id] = { total: 0, exchanged: 0 };
            
            // ä¿å­˜æ•°æ®
            saveSubjects();
            saveAllData();
            
            // é‡æ–°æ¸²æŸ“å¡ç‰‡
            renderAllCards();
            renderExistingSubjectsList();
            
            // é‡ç½®è¡¨å•
            document.getElementById('subjectForm').reset();
            updateColorPreview();
            
            alert(`ç§‘ç›®"${subjectName}"æ·»åŠ æˆåŠŸï¼`);
        });
        
        // åˆ é™¤ç§‘ç›®
        function deleteSubject(subjectId) {
            const subject = subjects.find(s => s.id === subjectId);
            if (!subject) return;
            
            if (!confirm(`ç¡®å®šè¦åˆ é™¤ç§‘ç›®"${subject.name}"å—ï¼Ÿæ­¤æ“ä½œå°†åŒæ—¶åˆ é™¤è¯¥ç§‘ç›®çš„æ‰€æœ‰ç§¯åˆ†å’Œçš‡å† æ•°æ®ï¼`)) {
                return;
            }
            
            // ä»ç§‘ç›®åˆ—è¡¨ä¸­ç§»é™¤
            subjects = subjects.filter(s => s.id !== subjectId);
            
            // åˆ é™¤å¯¹åº”çš„ç§¯åˆ†å’Œçš‡å† æ•°æ®
            delete scoreData[subjectId];
            delete crownData[subjectId];
            
            // ä¿å­˜æ•°æ®
            saveSubjects();
            saveAllData();
            
            // é‡æ–°æ¸²æŸ“
            renderAllCards();
            renderExistingSubjectsList();
            updateTotalCrowns();
            
            alert(`ç§‘ç›®"${subject.name}"å·²åˆ é™¤ï¼`);
        }
        
        // æ·»åŠ æ–°ç¤¼ç‰©
        function addNewGift() {
            const giftName = prompt("è¯·è¾“å…¥ç¤¼ç‰©åç§°ï¼š");
            if (!giftName) return;
            
            const giftCost = parseInt(prompt("è¯·è¾“å…¥å…‘æ¢è¯¥ç¤¼ç‰©éœ€è¦çš„çš‡å† æ•°ï¼š"));
            if (isNaN(giftCost) || giftCost <= 0) {
                alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æ­£æ•´æ•°ï¼");
                return;
            }
            
            const giftDesc = prompt("è¯·è¾“å…¥ç¤¼ç‰©æè¿°ï¼ˆå¯é€‰ï¼‰ï¼š") || "æ— æè¿°";
            
            // åˆ›å»ºæ–°ç¤¼ç‰©å¯¹è±¡
            const newGift = {
                id: Date.now(), // å”¯ä¸€ID
                name: giftName,
                cost: giftCost,
                desc: giftDesc,
                exchanged: false,
                color: giftColors[giftData.length % giftColors.length]
            };
            
            // æ·»åŠ åˆ°ç¤¼ç‰©åˆ—è¡¨
            giftData.push(newGift);
            
            // ä¿å­˜ç¤¼ç‰©æ•°æ®
            saveGiftData();
            
            // é‡æ–°æ¸²æŸ“ç¤¼ç‰©åˆ—è¡¨
            renderGiftList();
            
            // æ›´æ–°ç¤¼ç‰©æŒ‰é’®çŠ¶æ€
            updateGiftButtons();
        }
        
        // å…‘æ¢ç¤¼ç‰©
        function exchangeGift(giftId) {
            // æ‰¾åˆ°ç¤¼ç‰©
            const giftIndex = giftData.findIndex(gift => gift.id === giftId);
            if (giftIndex === -1) {
                alert("æœªæ‰¾åˆ°è¯¥ç¤¼ç‰©ï¼");
                return;
            }
            
            const gift = giftData[giftIndex];
            
            // æ£€æŸ¥æ˜¯å¦å·²å…‘æ¢
            if (gift.exchanged) {
                alert("è¯¥ç¤¼ç‰©å·²å…‘æ¢ï¼");
                return;
            }
            
            // æ£€æŸ¥çš‡å† æ•°é‡
            const totalCrowns = calculateTotalCrowns();
            if (totalCrowns < gift.cost) {
                alert(`çš‡å† æ•°é‡ä¸è¶³ï¼éœ€è¦${gift.cost}ä¸ªçš‡å† ï¼Œå½“å‰åªæœ‰${totalCrowns}ä¸ªã€‚`);
                return;
            }
            
            if (confirm(`ç¡®å®šè¦å…‘æ¢ã€${gift.name}ã€‘å—ï¼Ÿéœ€è¦æ¶ˆè€—${gift.cost}ä¸ªçš‡å† ã€‚`)) {
                // æ ‡è®°ç¤¼ç‰©ä¸ºå·²å…‘æ¢
                giftData[giftIndex].exchanged = true;
                
                // æ‰£é™¤çš‡å† ï¼ˆæŒ‰ç§‘ç›®å¹³å‡æ‰£é™¤ï¼‰
                const crownsToDeduct = gift.cost;
                let remainingToDeduct = crownsToDeduct;
                
                // éå†ç§‘ç›®æ‰£é™¤çš‡å† 
                subjects.forEach(subject => {
                    if (remainingToDeduct <= 0) return;
                    
                    const availableCrowns = crownData[subject.id].exchanged;
                    const deductNum = Math.min(availableCrowns, remainingToDeduct);
                    
                    if (deductNum > 0) {
                        crownData[subject.id].exchanged -= deductNum;
                        remainingToDeduct -= deductNum;
                        
                        // æ ¹æ®è§„åˆ™ï¼Œæ‰£é™¤çš‡å† åæ˜Ÿæ˜Ÿæ•°å˜ä¸º9ï¼ˆå¯¹åº”10åˆ†é˜ˆå€¼ï¼‰
                        scoreData[subject.id] = 9;
                    }
                });
                
                // ä¿å­˜æ•°æ®
                saveAllData();
                saveGiftData();
                
                // é‡æ–°æ¸²æŸ“
                renderAllCards();
                renderGiftList();
                updateTotalCrowns();
                updateGiftButtons();
                
                alert(`å…‘æ¢æˆåŠŸï¼å·²æ¶ˆè€—${gift.cost}ä¸ªçš‡å† ï¼Œè·å¾—ã€${gift.name}ã€‘ã€‚`);
            }
        }
        
        // åˆ é™¤ç¤¼ç‰©
        function deleteGift(giftId) {
            if (confirm("ç¡®å®šè¦åˆ é™¤è¯¥ç¤¼ç‰©å—ï¼Ÿ")) {
                // è¿‡æ»¤æ‰è¦åˆ é™¤çš„ç¤¼ç‰©
                giftData = giftData.filter(gift => gift.id !== giftId);
                
                // ä¿å­˜ç¤¼ç‰©æ•°æ®
                saveGiftData();
                
                // é‡æ–°æ¸²æŸ“ç¤¼ç‰©åˆ—è¡¨
                renderGiftList();
            }
        }
        
        // æ¸²æŸ“ç¤¼ç‰©åˆ—è¡¨
        function renderGiftList() {
            const giftGrid = document.getElementById('giftGrid');
            giftGrid.innerHTML = "";
            
            // å¦‚æœæ²¡æœ‰ç¤¼ç‰©
            if (giftData.length === 0) {
                giftGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #718096;">
                        <i class="fas fa-gift" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                        <p>æš‚æ— å¯å…‘æ¢ç¤¼ç‰©ï¼Œç‚¹å‡»"æ·»åŠ æ–°ç¤¼ç‰©"æŒ‰é’®åˆ›å»ºç¬¬ä¸€ä¸ªç¤¼ç‰©å§ï¼</p>
                    </div>
                `;
                return;
            }

            // æ‹†åˆ†æœªå…‘æ¢/å·²å…‘æ¢ç¤¼ç‰©ï¼ˆæœªå…‘æ¢åœ¨å‰ï¼‰
            const unExchangedGifts = giftData.filter(gift => !gift.exchanged);
            const exchangedGifts = giftData.filter(gift => gift.exchanged);
            const sortedGifts = [...unExchangedGifts, ...exchangedGifts];
            
            // æ¸²æŸ“æ¯ä¸ªç¤¼ç‰©
            sortedGifts.forEach(gift => {
                const giftCard = document.createElement('div');
                giftCard.className = `gift-card ${gift.color} ${gift.exchanged ? 'exchanged' : ''}`;
                giftCard.innerHTML = `
                    <div class="gift-name">
                        <i class="fas fa-gift"></i>${gift.name}
                    </div>
                    <div class="gift-cost">
                        <span>ğŸ‘‘</span> å…‘æ¢éœ€è¦ï¼š${gift.cost}ä¸ªçš‡å† 
                    </div>
                    <div class="gift-desc">${gift.desc}</div>
                    <div class="gift-actions">
                        <button class="exchange-gift-btn" ${gift.exchanged || calculateTotalCrowns() < gift.cost ? 'disabled' : ''} 
                                onclick="exchangeGift(${Number(gift.id)})">
                            <i class="fas fa-exchange-alt"></i>
                            ${gift.exchanged ? 'å·²å…‘æ¢' : 'å…‘æ¢ç¤¼ç‰©'}
                        </button>
                        <button class="delete-gift-btn" onclick="deleteGift(${Number(gift.id)})">
                            <i class="fas fa-trash"></i>åˆ é™¤
                        </button>
                    </div>
                `;
                giftGrid.appendChild(giftCard);
            });
        }
        
        // æ›´æ–°ç¤¼ç‰©æŒ‰é’®çŠ¶æ€
        function updateGiftButtons() {
            const totalCrowns = calculateTotalCrowns();
            const exchangeButtons = document.querySelectorAll('.exchange-gift-btn');
            
            exchangeButtons.forEach((btn, index) => {
                const sortedGifts = [...giftData.filter(g => !g.exchanged), ...giftData.filter(g => g.exchanged)];
                const gift = sortedGifts[index];
                if (gift && !gift.exchanged) {
                    btn.disabled = totalCrowns < gift.cost;
                }
            });
        }
        
        // ç”Ÿæˆè£èª‰è¯ä¹¦å›¾ç‰‡ï¼ˆå¸¦å¥–çŠ¶èƒŒæ™¯ï¼‰
        function generateCertificate() {
            const preview = document.getElementById('certificatePreview');
            preview.style.display = 'block';
            
            // è·å–å½“å‰æ—¥æœŸ
            const now = new Date();
            const dateStr = now.getFullYear() + 'å¹´' + (now.getMonth() + 1) + 'æœˆ' + now.getDate() + 'æ—¥';
            
            // è®¡ç®—å·²å…‘æ¢ç¤¼ç‰©æ•°
            const exchangedGifts = giftData.filter(gift => gift.exchanged).length;
            const totalCrowns = calculateTotalCrowns();
            
            // æ„å»ºå¥–çŠ¶HTML
            let certHtml = `
                <div class="certificate-bg">
                    <h1 class="certificate-title">è£èª‰è¯ä¹¦</h1>
                    <h2 class="certificate-subtitle">STAR AWARD CERTIFICATE</h2>
                    
                    <img src="${document.getElementById('avatarImg').src}" class="certificate-avatar" alt="Susanå¤´åƒ">
                    
                    <div class="certificate-content">
                        <p>å…¹æˆäºˆï¼šSusan å°æœ‹å‹</p>
                        <p>åœ¨æ˜Ÿæ˜Ÿå¤§ä½œæˆ˜æ´»åŠ¨ä¸­ï¼Œè¡¨ç°ä¼˜å¼‚ï¼Œè£è·ä»¥ä¸‹æˆå°±ï¼š</p>
                        <br>
            `;
            
            // æ·»åŠ å„ç§‘æˆç»©
            subjects.forEach(subject => {
                certHtml += `<p>â€¢ ${subject.name}ï¼š${scoreData[subject.id]}é¢—æ˜Ÿæ˜Ÿï¼Œ${crownData[subject.id].exchanged}ä¸ªçš‡å† </p>`;
            });
            
            // æ·»åŠ æ€»è®¡ä¿¡æ¯
            certHtml += `
                        <div class="certificate-total">
                            ç´¯è®¡è·å¾—ï¼š${totalCrowns}ä¸ªçš‡å† ï¼Œå·²å…‘æ¢${exchangedGifts}/${giftData.length}ä¸ªç¤¼ç‰©
                        </div>
                        <p>ç‰¹å‘æ­¤è¯ï¼Œä»¥èµ„é¼“åŠ±ï¼</p>
                    </div>
                    
                    <div class="certificate-footer">
                        é¢å‘æ—¥æœŸï¼š${dateStr} | Susanæ˜Ÿæ˜Ÿå¤§ä½œæˆ˜
                    </div>
                    
                    <div class="certificate-seal">
                        è£èª‰è®¤è¯<br>
                        ${dateStr}
                    </div>
                </div>
            `;
            
            preview.innerHTML = certHtml;
            
            // ç”Ÿæˆå›¾ç‰‡ï¼ˆå¢åŠ å»¶è¿Ÿç¡®ä¿æ ·å¼åŠ è½½å®Œæˆï¼‰
            setTimeout(() => {
                html2canvas(preview, {
                    scale: 2, // æé«˜åˆ†è¾¨ç‡
                    useCORS: true,
                    logging: false
                }).then(canvas => {
                    // æ¸…ç©ºé¢„è§ˆå¹¶æ˜¾ç¤ºç”Ÿæˆçš„å›¾ç‰‡
                    preview.innerHTML = '';
                    const img = document.createElement('img');
                    img.src = canvas.toDataURL('image/png', 1.0);
                    img.style.maxWidth = '100%';
                    img.style.borderRadius = '15px';
                    preview.appendChild(img);
                    
                    // æ·»åŠ ä¸‹è½½æŒ‰é’®
                    const downloadBtn = document.createElement('button');
                    downloadBtn.textContent = 'ä¸‹è½½è£èª‰è¯ä¹¦';
                    downloadBtn.className = 'generate-cert-btn';
                    downloadBtn.style.marginTop = '20px';
                    downloadBtn.onclick = () => {
                        const link = document.createElement('a');
                        link.download = `Susanæ˜Ÿæ˜Ÿè£èª‰è¯ä¹¦_${dateStr}.png`;
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                    };
                    preview.appendChild(downloadBtn);
                });
            }, 500);
            
            // æ»šåŠ¨åˆ°è¯ä¹¦åŒºåŸŸ
            preview.scrollIntoView({ behavior: 'smooth' });
        }
        
        // æ˜¾ç¤ºå¯¼å…¥/å¯¼å‡ºé€‰é¡¹
        function showImportExportOptions() {
            const option = prompt("è¯·é€‰æ‹©æ“ä½œï¼š\n1. å¯¼å‡ºæ•°æ®\n2. å¯¼å…¥æ•°æ®\n\nè¯·è¾“å…¥æ•°å­—ï¼š");
            
            if (option === "1") {
                exportData();
            } else if (option === "2") {
                importData();
            }
        }
        
        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const data = {
                subjects: subjects,
                scoreData: scoreData,
                crownData: crownData,
                giftData: giftData,
                historyData: historyData,
                avatarData: avatarData,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `susan_star_data_${new Date().getTime()}.json`;
            a.click();
            
            alert("æ•°æ®å¯¼å‡ºæˆåŠŸï¼");
        }
        
        // å¯¼å…¥æ•°æ®
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        
                        // éªŒè¯æ•°æ®æ ¼å¼
                        if (importedData.subjects && importedData.scoreData && importedData.crownData) {
                            if (confirm("å¯¼å…¥æ•°æ®å°†è¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼Œç¡®å®šè¦å¯¼å…¥å—ï¼Ÿ")) {
                                subjects = importedData.subjects;
                                scoreData = importedData.scoreData;
                                crownData = importedData.crownData;
                                giftData = importedData.giftData || giftData;
                                historyData = importedData.historyData || historyData;
                                avatarData = importedData.avatarData || avatarData;
                                
                                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                                saveSubjects();
                                saveAllData();
                                saveGiftData();
                                saveHistoryData();
                                saveAvatar();
                                
                                // æ›´æ–°UI
                                renderAllCards();
                                renderGiftList();
                                updateTotalCrowns();
                                if (avatarData) {
                                    document.getElementById('avatarImg').src = avatarData;
                                }
                                
                                alert("æ•°æ®å¯¼å…¥æˆåŠŸï¼");
                            }
                        } else {
                            alert("å¯¼å…¥çš„æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼");
                        }
                    } catch (error) {
                        alert("å¯¼å…¥å¤±è´¥ï¼š" + error.message);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // ä¿å­˜æ‰€æœ‰æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveAllData() {
            const saveData = {
                scoreData: scoreData,
                crownData: crownData
            };
            localStorage.setItem("susanStarData", JSON.stringify(saveData));
            // åŒæ—¶ä¿å­˜ç§‘ç›®æ•°æ®
            saveSubjects();
        }
        
        // ä¿å­˜ç¤¼ç‰©æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveGiftData() {
            localStorage.setItem("susanGiftData", JSON.stringify(giftData));
        }
        
        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
        function loadData() {
            const savedData = localStorage.getItem("susanStarData");
            if (savedData) {
                const data = JSON.parse(savedData);
                scoreData = data.scoreData || scoreData;
                crownData = data.crownData || crownData;
            }
        }
        
        // åŠ è½½ç¤¼ç‰©æ•°æ®
        function loadGiftData() {
            const savedGiftData = localStorage.getItem("susanGiftData");
            if (savedGiftData) {
                giftData = JSON.parse(savedGiftData);
            } else {
                // é»˜è®¤ç¤¼ç‰©
                giftData = [
                    {
                        id: 1,
                        name: "å¡é€šè´´çº¸",
                        cost: 1,
                        desc: "å¯çˆ±çš„å¡é€šè´´çº¸ä¸€å¼ ",
                        exchanged: false,
                        color: giftColors[0]
                    },
                    {
                        id: 2,
                        name: "ç»˜æœ¬æ•…äº‹ä¹¦",
                        cost: 3,
                        desc: "ç²¾ç¾ç»˜æœ¬æ•…äº‹ä¹¦ä¸€æœ¬",
                        exchanged: false,
                        color: giftColors[1]
                    },
                    {
                        id: 3,
                        name: "æ¸¸ä¹å›­é—¨ç¥¨",
                        cost: 5,
                        desc: "å„¿ç«¥æ¸¸ä¹å›­é—¨ç¥¨ä¸€å¼ ",
                        exchanged: false,
                        color: giftColors[2]
                    }
                ];
            }
        }
        
        // é‡ç½®æ‰€æœ‰æ•°æ®
        function resetAllData() {
            if (confirm("ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œå°†æ¸…é™¤æ‰€æœ‰ç§¯åˆ†ã€çš‡å† å’Œç¤¼ç‰©å…‘æ¢è®°å½•ï¼")) {
                // é‡ç½®ç§¯åˆ†æ•°æ®
                subjects.forEach(subject => {
                    scoreData[subject.id] = 0;
                    crownData[subject.id] = { total: 0, exchanged: 0 };
                });
                
                // é‡ç½®ç¤¼ç‰©å…‘æ¢çŠ¶æ€
                giftData.forEach(gift => {
                    gift.exchanged = false;
                });
                
                // æ¸…ç©ºå†å²è®°å½•
                historyData = [];
                saveHistoryData();
                
                // æ¸…é™¤æœ¬åœ°å­˜å‚¨
                localStorage.removeItem("susanStarData");
                saveGiftData();
                
                // é‡æ–°æ¸²æŸ“
                renderAllCards();
                renderGiftList();
                renderHistoryList();
                updateTotalCrowns();
                updateGiftButtons();
                
                alert("æ‰€æœ‰æ•°æ®å·²é‡ç½®ï¼");
            }
        }
        
        // é¡µé¢åŠ è½½åˆå§‹åŒ–
        window.onload = initData;
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const batchModal = document.getElementById('batchModal');
            const subjectModal = document.getElementById('subjectModal');
            const historyModal = document.getElementById('historyModal');
            
            if (event.target === batchModal) {
                closeBatchModal();
            }
            if (event.target === subjectModal) {
                closeSubjectModal();
            }
            if (event.target === historyModal) {
                closeHistoryModal();
            }
        };
    </script>
</body>
</html>
